<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style_gradation.css">
  <link rel="icon" href="icon.png" type="image/x-icon">
  <link rel="shortcut icon" href="icon.png" type="image/x-icon">

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5483486229407301" crossorigin="anonymous"></script>
  
  <title>RGBing(ì•Œì§€ë¹™)</title>
</head>
<body>
  <div class="menu-container">
    <div id="menu-toggle" class="menu-button">â˜°</div>
  </div>
  <div id="side-menu" class="side-menu">
      <div class="side-menu-header">
          <div id="menu-close" class="menu-close">Ã—</div>
      </div>
      <div class="menu-list">
          <div class="menu-category">
              <li onclick="window.location.href='index.html'">ğŸ  í™ˆìœ¼ë¡œ</li>
          </div>
          <div class="menu-category">
              <h4>ğŸ® ë¯¸ë‹ˆ ê²Œì„</h4>
              <ul>
                  <li onclick="window.location.href='rgbing.html'">ìƒ‰ ë§ì¶”ê¸°</li>
                  <li onclick="window.location.href='gradation.html'">ê·¸ë¼ë°ì´ì…˜</li>
                  <li onclick="window.location.href='whack.html'">ë‘ë”ì§€ ì¡ê¸°</li>
              </ul>
          </div>
          <div class="menu-category">
            <h4>ğŸ¨ ìƒ‰ ê¸°ë¡ì¥</h4>
            <ul>
                <li onclick="goCollection()">ìƒ‰ ì»¬ë ‰ì…˜</li>
                <li onclick="window.location.href='month.html'">ê³¼ê±°ì˜ ìƒ‰ ê¸°ë¡</li>
            </ul>
        </div>
        <div class="menu-category">
            <h4>âœ ìƒ‰ê³¼ ê¸€</h4>
            <ul>
                <li onclick="window.location.href='login.html'">ì˜¤ëŠ˜ì˜ ê¸€</li>
            </ul>
        </div>
          <div class="menu-category">
              <h4>ğŸ“Œ ê¸°íƒ€ ë§í¬</h4>
              <ul>
                  <li onclick="goInsta()">ì¸ìŠ¤íƒ€ê·¸ë¨</li>
                  <li onclick="goBlog()">ê³µì‹ ë¸”ë¡œê·¸</li>
              </ul>
          </div>
      </div>
  </div>

  <div class="option-box"><!--
      <button id="music-toggle" class="music-button">ğŸ”•</button>
      <audio id="background-music" src="Strollin' - TrackTribe.mp3" loop></audio>
      <button id="share-toggle" class="music-button" onclick="shareContent()">ğŸ’Œ</button>-->
      <button id="clear-toggle" class="clear-button" onclick="showClear()">ğŸ¥‡</button>
  </div>
  <div class="top-box">
    <h1>ê·¸ë¼ë°ì´ì…˜ ê²Œì„</h1>
    <p id="top-1" class="top-1"><b></b></p>
  </div>
  <div class="game-box">
    <div class="color-section">
      <div>
        <h3>ì˜¤ëŠ˜ì˜ ìƒ‰</h3>
        <div class="color-box" id="todayColorBox"></div>
      </div>
      <div>
        <h3>ë¬¸ì œ</h3>
        <div class="color-box" id="alteredColorBox"></div>
      </div>
    </div>
    <div class="buttons">
      <button id="sameBtn">ê°™ë‹¤</button>
      <button id="changedBtn">ë‹¤ë¥´ë‹¤</button>
    </div>
    <div class="score" id="scoreDisplay">ì ìˆ˜: 0</div>
    <div class="result" id="result"></div>
    <div class="buttons">
      <button id="restartBtn" class="hidden">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
  </div>
  <div id="qna-box" class="qna-box">
    <p class="qna-title">Q&A</p>
    <div class="color-div-2"></div>
    <p class="qna-1">1. ê·¸ë¼ë°ì´ì…˜ ê²Œì„ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
    <p class="qna-2">ê·¸ë¼ë°ì´ì…˜ ê²Œì„ì€ <span class="qna-line">í•˜ë£¨ì— í•œ ë²ˆ</span> ì •í•´ì§€ëŠ” ì˜¤ëŠ˜ì˜ ìƒ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì œì˜ ìƒ‰ì´ ë³€í•˜ì˜€ëŠ”ì§€ì˜ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ê²Œì„ì…ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ë“¤ì˜ ìƒ‰ê° ì„¼ìŠ¤ë¥¼ í™œìš©í•´ì„œ ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”. 'ìƒ‰ ë§ì¶”ê¸°'ì™€ëŠ” ë‹¤ë¥´ê²Œ í•˜ë£¨ì— ëª‡ ë²ˆì´ê³  ë„ì „í•  ìˆ˜ ìˆë‹µë‹ˆë‹¤!</p>
  </div>

  <script>
    // ì˜¤ëŠ˜ì˜ ìƒ‰ ì„¤ì •
    let todayColor = { r: 255, g: 255, b: 255 }; // ê³ ì •ëœ RGB ê°’
    let clearscore, answer, name;

    const today = new Date().toLocaleDateString("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      timeZone: "Asia/Seoul"
    }).replace(/\./g, "/").replace(/\s/g, "").replace(/\/$/, "");

    // Firebase ì´ˆê¸°í™”
    const firebaseConfig = {
      apiKey: "AIzaSyCyyqlzjApUgvJyysZKJIfY4lVz-lWmyEM",
      authDomain: "rgbing-3a593.firebaseapp.com",
      projectId: "rgbing-3a593",
      storageBucket: "rgbing-3a593.firebasestorage.app",
      messagingSenderId: "503895940241",
      appId: "1:503895940241:web:5e42593e93572563ac3330",
      measurementId: "G-RTREG5QN0D"
    };

    // Firebase ì•± ì´ˆê¸°í™”
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ì´ˆê¸°í™” ì‹œ Firebaseì—ì„œ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
    window.onload = () => {
      loadData();
    };

    function loadData() {
      const colorDataRef = database.ref('/color_data/' + today);
      colorDataRef.once('value', (snapshot) => {
        const colorData = snapshot.val();

        if (colorData) {
          todayColor.r = colorData.red;
          todayColor.g = colorData.green;
          todayColor.b = colorData.blue;

          // ì˜¤ëŠ˜ì˜ ìƒ‰ ë°•ìŠ¤ ì´ˆê¸°í™”
          updateColorBox(todayColorBox, todayColor);

          // Firebase ë°ì´í„° ë¡œë“œ í›„ ì²« ë²ˆì§¸ ë¬¸ì œ ìƒì„±
          generateNewQuestion();
        } else {
          console.error("ì˜¤ëŠ˜ì˜ ìƒ‰ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      });
      loadScore();
      
    } 
    function loadScore() {
      const clearDataRef = database.ref('/high_score/' + today + '/score/');
        clearDataRef.once('value', (snapshot) => {
            // ë°ì´í„°ë¥¼ JSON ê°ì²´ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const clearData = snapshot.val();

            // ì›í•˜ëŠ” ê°’ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
            clearscore = clearData;
            setColorOfTheDay();
      });

      const nameDataRef = database.ref('/high_score/' + today + '/name/');
        nameDataRef.once('value', (snapshot) => {
            // ë°ì´í„°ë¥¼ JSON ê°ì²´ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const nameData = snapshot.val();

            // ì›í•˜ëŠ” ê°’ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
            name = nameData;
            setColorOfTheDay();
      });
    }

    function setColorOfTheDay() {
      document.getElementById("clear-toggle").textContent = `ğŸ¥‡ ${clearscore}`;
      if(name != null) {
        document.getElementById("top-1").innerHTML = `<b>'${name}'ë‹˜ì„ ì´ê²¨ë¼!</b>`;
      }else {
        document.getElementById("top-1").innerHTML = `<b>ì•„ì§ ê¸°ë¡ëœ ì ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</b>`;
      }
      
    }

    // ì„±ê³µ íšŸìˆ˜ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
    function showClear() {
      if(name != null) {
        alert(`${today}\nì˜¤ëŠ˜ì˜ ìµœê³  ì ìˆ˜ëŠ” '${name}'ë‹˜ì´ ì„¸ìš´ ${clearscore}ì  ì…ë‹ˆë‹¤.`);
      }else {
        alert(`ì•„ì§ ê¸°ë¡ëœ ì ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.`);
      }
    }

    let alteredColor = { ...todayColor }; // ë³€í™”ëœ ìƒ‰ ì´ˆê¸°ê°’
    let isColorChanged = false; // ìƒ‰ìƒ ë³€ê²½ ì—¬ë¶€ í”Œë˜ê·¸
    let score = 0; // ì •ë‹µ íšŸìˆ˜

    // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const todayColorBox = document.getElementById("todayColorBox");
    const alteredColorBox = document.getElementById("alteredColorBox");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const resultDisplay = document.getElementById("result");
    const restartBtn = document.getElementById("restartBtn");
    const changedBtn = document.getElementById("changedBtn");
    const sameBtn = document.getElementById("sameBtn");

    // ìƒ‰ìƒ ë°•ìŠ¤ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateColorBox(element, color) {
      element.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
      document.documentElement.style.setProperty('--random-color', `RGB(${color.r}, ${color.g}, ${color.b})`);
    }

    // ìƒˆë¡œìš´ ë¬¸ì œ ìƒì„± í•¨ìˆ˜
    function generateNewQuestion() {
      // 50% í™•ë¥ ë¡œ ìƒ‰ìƒ ë³€í™”
      isColorChanged = Math.random() > 0.35;

      if (isColorChanged) {
        // RGB ê°’ì„ ì•½ê°„ ë³€ê²½ (Â±10 ë²”ìœ„ì—ì„œ ëœë¤ ë³€í™”)
        alteredColor = {
          r: Math.min(255, Math.max(0, todayColor.r + Math.floor(Math.random() * 21 - 10))),
          g: Math.min(255, Math.max(0, todayColor.g + Math.floor(Math.random() * 21 - 10))),
          b: Math.min(255, Math.max(0, todayColor.b + Math.floor(Math.random() * 21 - 10))),
        };
        answer = calculateSimilarity(alteredColor);
      } else {
        // ìƒ‰ìƒì„ ê·¸ëŒ€ë¡œ ìœ ì§€
        alteredColor = { ...todayColor };
        answer = calculateSimilarity(alteredColor);
      }

      // ë°•ìŠ¤ ì—…ë°ì´íŠ¸
      updateColorBox(alteredColorBox, alteredColor);

      // í”ë“¤ë¦¼ íš¨ê³¼ ì¶”ê°€
      alteredColorBox.classList.add("shake");
      setTimeout(() => {
        alteredColorBox.classList.remove("shake");
      }, 500);

      resultDisplay.textContent = ""; // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
    }

    // ê²Œì„ ì¢…ë£Œ í•¨ìˆ˜
    function endGame() {
      alert("ê²Œì„ ì˜¤ë²„! ìµœì¢… ì ìˆ˜: " + score);
      resultDisplay.textContent = `ê²Œì„ ì˜¤ë²„!\nìƒ‰ ìœ ì‚¬ë„: ${answer}%`;
      resultDisplay.style.color = "red";

      // ë²„íŠ¼ ë¹„í™œì„±í™”
      changedBtn.disabled = true;
      sameBtn.disabled = true;

      if(score > clearscore) {
        database.ref('/high_score/' + today).update({
          score
        });
        let userName = prompt("ì˜¤ëŠ˜ì˜ ìµœê³  ì ìˆ˜ë¥¼ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤!\nê¸°ë¡í•  ë‹‰ë„¤ì„ì„ ì‘ì„±í•˜ì„¸ìš”:");
        database.ref('/high_score/' + today).update({
          name: userName
        });
        loadScore();
      }

      // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
      restartBtn.classList.remove("hidden");
    }

    // ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜
    function restartGame() {
      score = 0;
      scoreDisplay.textContent = `ì ìˆ˜: ${score}`;
      resultDisplay.textContent = "";
      resultDisplay.style.color = "black";

      // ë²„íŠ¼ í™œì„±í™”
      changedBtn.disabled = false;
      sameBtn.disabled = false;

      // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
      restartBtn.classList.add("hidden");

      // ìƒˆë¡œìš´ ë¬¸ì œ ìƒì„±
      generateNewQuestion();
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    changedBtn.addEventListener("click", () => {
      if (calculateSimilarity(alteredColor) != 100) {
        // ì •ë‹µ
        score++;
        scoreDisplay.textContent = `ì ìˆ˜: ${score}`;
        generateNewQuestion();
      } else {
        // ì˜¤ë‹µ
        endGame();
      }
    });

    sameBtn.addEventListener("click", () => {
      if (calculateSimilarity(alteredColor) == 100) {
        // ì •ë‹µ
        score++;
        scoreDisplay.textContent = `ì ìˆ˜: ${score}`;
        generateNewQuestion();
      } else {
        // ì˜¤ë‹µ
        endGame();
      }
    });

    // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    restartBtn.addEventListener("click", () => {
      restartGame();
      generateNewQuestion();
    });

    // ìœ ì‚¬ë„ ê³„ì‚° í•¨ìˆ˜
    function calculateSimilarity(inputColor) {
      const rDiff = Math.abs(inputColor.r - todayColor.r);
      const gDiff = Math.abs(inputColor.g - todayColor.g);
      const bDiff = Math.abs(inputColor.b - todayColor.b);

      const maxDifference = 255 * 3;
      const totalDifference = rDiff + gDiff + bDiff;

      // ìœ ì‚¬ë„ë¥¼ 0ì—ì„œ 100%ë¡œ ë³€í™˜
      return ((1 - totalDifference / maxDifference) * 100).toFixed(2);
    }

    // ì²« ë²ˆì§¸ ë¬¸ì œ ìƒì„±
    generateNewQuestion();

    const menuToggle = document.getElementById("menu-toggle");
        const sideMenu = document.getElementById("side-menu");
        const menuClose = document.getElementById("menu-close");

        menuToggle.addEventListener("click", () => {
            sideMenu.style.left = "0";
            menuToggle.style.display = "none"; // ë©”ë‰´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        });

        menuClose.addEventListener("click", () => {
            sideMenu.style.left = "-250px";
            menuToggle.style.display = "block";
        });

        function goCollection() {
            let userName = prompt("ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:");
            if(userName != null) {
                // ì‚¬ìš©ì IDê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
                const userRef = database.ref('users/' + userName);
                userRef.once('value', function(snapshot) {
                    if (snapshot.exists()) {
                        let userPass = prompt("ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:");
                        const userRef2 = database.ref('users/' + userName + '/password');
                        userRef2.once('value', function(snapshot) {
                            if (snapshot.val() == userPass) {
                                if(userName == 'ê´€ë¦¬ì') {
                                    localStorage.setItem('userName', userName);
                                    window.location.href = 'collection_manager.html';
                                }
                                else {
                                    localStorage.setItem('userName', userName);
                                    window.location.href = 'collection.html';
                                }
                            } else {
                                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                            }
                        });
                    } else {
                        alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ID ì…ë‹ˆë‹¤.");
                    }
                });
            }
            else alert("ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        function goInsta() {
            window.location.href = 'https://www.instagram.com/sofancat_com/profilecard/?igsh=MXI1ZDNqNjExNTJ4dQ==';
        }
        function goBlog() {
            window.location.href = 'https://rgbing.tistory.com/';
        }
  </script>
</body>
</html>
